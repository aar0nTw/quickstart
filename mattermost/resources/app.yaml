apiVersion: bundle.gravitational.io/v2
kind: Bundle
metadata:
  name: mattermost
  resourceVersion: "2.2.0"
logo: http://about.mattermost.com/wp-content/uploads/2016/01/logo.png
endpoints:
  - name: "Mattermost"
    description: "Mattermost application"
    selector:
      role: mattermost-worker
    protocol: http
  - name: "Setup"
    serviceName: bandwagon
    hidden: true
providers:
  aws:
    regions:
      - us-east-2
installer:
  setupEndpoints:
    - "Setup"
  flavors:
    prompt: "How many nodes do you want?"
    items:
      - name: "single"
        description: "One node"
        nodes:
          - profile: node
            count: 1
      - name: "double"
        description: "Two-node cluster"
        nodes:
          - profile: node
            count: 2
      - name: "triple"
        description: "Three-node cluster"
        nodes:
          - profile: node
            count: 3
nodeProfiles:
  - name: node
    description: "Simple Mattermost Server"
    requirements:
      cpu:
        min: 1
      ram:
        min: "2GB"
    providers:
      aws:
        instanceTypes:
          - m4.xlarge
hooks:
  install:
    job: file://install.yaml
  clusterProvision:
    job: file://clusterProvision.yaml
  nodesProvision:
    job: file://nodesProvision.yaml
  nodesDeprovision:
    job: file://nodesDeprovision.yaml
  clusterDeprovision:
    job: file://clusterDeprovision.yaml
systemOptions:
  docker:
    storageDriver: overlay2
  runtime:
    version: 5.2.0
